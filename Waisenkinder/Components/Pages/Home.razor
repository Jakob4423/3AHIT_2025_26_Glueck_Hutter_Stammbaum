@* 
    Startseite der Stammbaum-Anwendung.
    Zeigt ein Modal mit Register- und Login-Funktionalität.
    Nach erfolgreichem Login wird das Modal geschlossen.
	Glück
*@
@page "/"
@using ITP2Tree.Components.Shared

<PageTitle>Home - Stammbaum für Waisenkinder</PageTitle>

<h1 class="display-5">Willkommen zu Waisenkinder.Tree</h1>

@* Modal mit Register/Login Tabs *@
@if (showModal)
{
	<div class="modal-backdrop-custom" @onclick="CloseOnBackdrop">
		<div class="modal-card" @onclick:stopPropagation>
			<div class="d-flex mb-3 align-items-center">
				<button class="me-2" @onclick="SelectRegister">Registrieren</button>
				<button class="me-2" @onclick="SelectLogin">Login</button>
				<button class="btn btn-sm btn-link ms-auto" @onclick="CloseModal">×</button>
			</div>

			<div>
				@if (activeTab == "register")
				{
					<RegisterForm OnSuccess="OnRegistered" />
				}
				else
				{
					<LoginForm OnSuccess="OnLoggedIn" />
				}
			</div>
		</div>
	</div>
}

@code {
	/// <summary>
	/// Steuert, ob das Modal sichtbar ist.
	/// </summary>
	private bool showModal = true;

	/// <summary>
	/// Aktiver Tab: "register" oder "login".
	/// </summary>
	private string activeTab = "register";

	/// <summary>
	/// Wechselt zum angegebenen Tab.
	/// </summary>
	private void SelectTab(string tab)
	{
		activeTab = tab;
	}

	/// <summary>
	/// Wechselt zum Register-Tab.
	/// </summary>
	private void SelectRegister() => SelectTab("register");

	/// <summary>
	/// Wechselt zum Login-Tab.
	/// </summary>
	private void SelectLogin() => SelectTab("login");

	/// <summary>
	/// Schließt das Modal.
	/// </summary>
	private void CloseModal() => showModal = false;

	/// <summary>
	/// Schließt das Modal, wenn auf den Hintergrund geklickt wird.
	/// </summary>
	private void CloseOnBackdrop()
	{
		CloseModal();
	}

	/// <summary>
	/// Wird aufgerufen, wenn die Registrierung erfolgreich war.
	/// Wechselt zum Login-Tab, damit sich der Benutzer anmelden kann.
	/// </summary>
	private void OnRegistered()
	{
		activeTab = "login";
		StateHasChanged();
	}

	/// <summary>
	/// Wird aufgerufen, wenn der Login erfolgreich war.
	/// Schließt das Modal und navigiert zur geschützten Seite.
	/// </summary>
	private void OnLoggedIn()
	{
		CloseModal();
		StateHasChanged();
	}
}


